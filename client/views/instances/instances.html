<template name="instances">
<div class="container instances">
  <div class="row">
      <div class="col-sm-3">
        <h3><i class="glyphicon glyphicon-briefcase"></i> Toolbox</h3>
        <hr>

        <ul class="nav nav-stacked">
          <li><a href="{{pathFor 'apps'}}"><i class="glyphicon glyphicon-plus"></i> New Instance</a></li>
        </ul>

        <hr>

      </div>

      <div class="col-sm-9">
        <div class="row">
          <div class="col-md-8"><h1 class="pageTitle"><i class="glyphicon glyphicon-forward"></i> Instances</h1></div>
          <div class="col-md-4">
            {{> filterBox sessionVar='queryName'}}
          </div>
        </div>
        <hr>

        <div class="row">
          <div class="col-md-12">

            {{#each instances}}
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title heading-flex-container">
                  <span class="glyphicon glyphicon-{{activityIcon}}"></span>
                  {{#if instanceLink}}
                    <a href="{{instanceLink}}" class="instance-link" target="_blank">{{name}}</a>
                  {{else}}
                    <span style="padding-left:5px;" title="This application does not have a web UI.">{{name}}</span>
                  {{/if}}
                  <a data-toggle="collapse" data-target="#instancePanel-{{instanceHash}}"
                     href="#instancePanel-{{name}}" class="collapsed toggle titleToggle">
                  </a>
                  {{#if showProgressbar}}
                  <div class="progress">
                    <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{progressPercentage}}%;">
                      <span>{{meta.stateDescription}}</span>
                    </div>
                  </div>
                  {{/if}}
                  {{#with parameters.tags}}
                  <div class="labelbox">
                    {{#each this}}<span class="label label-default">{{this}}</span>{{/each}}
                  </div>
                  {{/with}}
                  <a data-toggle="collapse" data-target="#instancePanel-{{instanceHash}}" href="#" class="collapsed toggle"></a>
                </h4>

              </div>
              <div id="instancePanel-{{instanceHash}}" class="panel-collapse collapse">
                  <div class="panel-body">
                    <ul class="nav nav-justified pull-right" style="margin-bottom:5px">
                      <li class="btn-group">

                        <a title="Logs" class="showLogs" href="#" data-toggle="modal" data-target="#logsModal">
                          <i class="glyphicon glyphicon-list-alt"></i>
                        </a>
                      </li>
                      <li class="btn-group">

                        <a title="Stop" href="#" class="dropdown-toggle" data-toggle="dropdown">
                          <i class="glyphicon glyphicon-stop"></i>
                        </a>
                        <form role="form" class="dropdown-menu dropdown-menu-right" style="padding:1em">
                            <div class="form-group" style="width:20em">
                              Do you really want to stop this application?
                            </div>
                            <button type="button" class="stop-instance btn btn-mini btn-danger pull-right">Yes!</button>
                        </form>

                      </li>
                      <li class="btn-group">

                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                          <i class="glyphicon glyphicon-trash"></i>
                        </a>
                        <form role="form" class="dropdown-menu dropdown-menu-right" style="padding:1em">
                            <div class="form-group" style="width:20em">
                              <div class="alert alert-warning" role="alert">
                                <span class="label label-danger">Expert feature!</span> <br />
                                Do you really want to clear the instance meta information?
                              </div>

                            </div>
                            <button type="button" class="clear-instance btn btn-mini btn-danger pull-right">Yes!</button>
                        </form>

                      </li>
                    </ul>

                    {{#with meta}}
                    <table class="table table-condensed">
                      <tbody>
                        <tr><th scope="row" style="width:250px;">Application name</th><td>{{appName}}</td></tr>
                        <tr><th scope="row">Application version</th><td>{{appVersion}}</td></tr>
                        <tr><th scope="row">State</th><td>{{stateDescription}}</td></tr>
                      </tbody>
                    </table>
                    {{/with}}

                    {{#each services}}
                    <h5>
                      {{name}}
                      {{#with service=. instance=..}}
                      <a href="#" class="open-terminal"><span class="glyphicon glyphicon-console" aria-hidden="true"></span>&nbsp;</a>
                      {{/with}}
                    </h5>
                    <table class="table table-condensed">
                      <tbody>
                        <tr><th scope="row" style="width:250px;">FQDN</th><td>{{data.hostname}}</td></tr>
                        <tr><th scope="row">Container IP</th><td>{{data.ip}}</td></tr>
                        {{#if isAdminBoard}}
                        <tr><th scope="row">Host IP</th><td>{{data.hostIp}}</td></tr>
                        <tr><th scope="row">Agent IP</th><td>{{data.agentIp}}</td></tr>
                        {{/if}}
                        <tr><th scope="row">Ports</th><td>{{data.ports}}</td></tr>
                        <tr><th scope="row">Port Mapping</th><td>{{data.portMapping}}</td></tr>
                        <tr><th scope="row">Container Name</th><td>{{data.dockerContainerName}}</td></tr>
                      </tbody>
                    </table>
                    {{/each}}
                  </div>
              </div>
            </div>
            {{/each}}

            {{#if isSearching}}
            <div class="searchInfo">
              Showing results for: "{{searchTerms}}" <br />
              <button id="reset" type="button" class="btn btn-link">- reset -</button>
            </div>
            {{/if}}
          </div>

        </div>
      </div>

  </div>
</div>

{{> logsModal }}
</template>

<template name="logsModal">
  <div id="logsModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="z-index: 99999999999;">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Log</h4>
        </div>
        <div class="modal-body">
           <textarea class="form-control" rows="35">{{logs.bootstrapLog}}</textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</template>
